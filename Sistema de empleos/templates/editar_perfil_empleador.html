{% extends "base.html" %}

{% block content %}
<!-- Header del Dashboard -->
<div class="dashboard-header">
    <div class="container">
        <div class="welcome-section">
            <div class="welcome-content">
                <h1 class="welcome-title">
                    Bienvenido, <span class="text-gradient">{{ empleador.empresa }}</span>
                </h1>
                <p class="welcome-subtitle">
                    Gestiona tus oportunidades laborales y conecta con el mejor talento universitario
                </p>
            </div>
            <div class="welcome-actions">
                <a href="{{ url_for('publicar_trabajo') }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    Publicar Trabajo
                </a>
                <a href="{{ url_for('editar_perfil_empleador') }}" class="btn btn-outline">
                    <i class="fas fa-edit"></i>
                    Editar Perfil
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Sección de Alertas Recientes -->
{% set alertas_recientes = [] %}
{% for alerta in alertas %}
    {% if alerta.destinatario in ['todos', 'empleadores'] %}
        {% set _ = alertas_recientes.append(alerta) %}
    {% endif %}
{% endfor %}

{% if alertas_recientes %}
<section class="section">
    <div class="container">
        <div class="section-header">
            <h2>
                <i class="fas fa-bell"></i>
                Alertas Recientes
            </h2>
            <a href="{{ url_for('ver_alertas') }}" class="btn btn-sm btn-outline">
                Ver Todas
            </a>
        </div>
        
        <div class="alertas-grid">
            {% for alerta in alertas_recientes[-3:] %}
            <div class="card alerta-card alerta-{{ alerta.tipo }}">
                <div class="alerta-header">
                    <div class="alerta-icon">
                        {% if alerta.tipo == 'urgente' %}
                            <i class="fas fa-exclamation-triangle"></i>
                        {% elif alerta.tipo == 'advertencia' %}
                            <i class="fas fa-exclamation-circle"></i>
                        {% else %}
                            <i class="fas fa-info-circle"></i>
                        {% endif %}
                    </div>
                    <div class="alerta-title">
                        <h4>{{ alerta.titulo }}</h4>
                        <span class="alerta-badge badge-{{ alerta.tipo }}">
                            {{ alerta.tipo|title }}
                        </span>
                    </div>
                    <div class="alerta-time">
                        <small>{{ alerta.fecha_envio[:10] }}</small>
                    </div>
                </div>
                <div class="alerta-body">
                    <p>{{ alerta.mensaje }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Información de la Empresa y Acciones Rápidas -->
<section class="section">
    <div class="container">
        <div class="info-actions-grid">
            <!-- Información de la Empresa -->
            <div class="card info-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <h3 class="card-title">Información de la Empresa</h3>
                </div>
                <div class="card-body">
                    <div class="company-info">
                        <div class="info-item">
                            <i class="fas fa-building"></i>
                            <div>
                                <span class="info-label">Empresa</span>
                                <span class="info-value">{{ empleador.empresa }}</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-user-tie"></i>
                            <div>
                                <span class="info-label">Representante</span>
                                <span class="info-value">{{ empleador.nombre_representante }}</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-phone"></i>
                            <div>
                                <span class="info-label">Teléfono</span>
                                <span class="info-value">{{ empleador.telefono }}</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <div>
                                <span class="info-label">Dirección</span>
                                <span class="info-value">{{ empleador.direccion }}</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-industry"></i>
                            <div>
                                <span class="info-label">Rubro</span>
                                <span class="info-value">{{ empleador.rubro }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <a href="{{ url_for('editar_perfil_empleador') }}" class="btn btn-primary btn-sm">
                        <i class="fas fa-edit"></i>
                        Actualizar Información
                    </a>
                </div>
            </div>

            <!-- Acciones Rápidas -->
            <div class="card actions-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <h3 class="card-title">Acciones Rápidas</h3>
                </div>
                <div class="card-body">
                    <div class="actions-grid">
                        <a href="{{ url_for('publicar_trabajo') }}" class="action-item">
                            <div class="action-icon">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="action-content">
                                <span class="action-title">Publicar Trabajo</span>
                                <span class="action-description">Crea una nueva oportunidad laboral</span>
                            </div>
                            <i class="fas fa-chevron-right action-arrow"></i>
                        </a>
                        
                        <a href="{{ url_for('empleador_trabajos_activos') }}" class="action-item">
                            <div class="action-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="action-content">
                                <span class="action-title">Trabajos Activos</span>
                                <span class="action-description">Gestiona colaboraciones en curso</span>
                            </div>
                            <i class="fas fa-chevron-right action-arrow"></i>
                        </a>
                        
                        <a href="{{ url_for('ver_mensajes') }}" class="action-item">
                            <div class="action-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div class="action-content">
                                <span class="action-title">Mis Mensajes</span>
                                <span class="action-description">Comunícate con estudiantes</span>
                            </div>
                            <i class="fas fa-chevron-right action-arrow"></i>
                        </a>
                        
                        <a href="{{ url_for('ver_alertas') }}" class="action-item">
                            <div class="action-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div class="action-content">
                                <span class="action-title">Ver Alertas</span>
                                <span class="action-description">Notificaciones importantes</span>
                            </div>
                            <i class="fas fa-chevron-right action-arrow"></i>
                        </a>
                        
                        <a href="{{ url_for('mis_reportes') }}" class="action-item">
                            <div class="action-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="action-content">
                                <span class="action-title">Mis Reportes</span>
                                <span class="action-description">Estadísticas y reportes</span>
                            </div>
                            <i class="fas fa-chevron-right action-arrow"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Sección de Trabajos Activos -->
{% set trabajos_activos_list = [] %}
{% for trabajo in trabajos_activos %}
    {% if trabajo.empleador_id == session.user_id and trabajo.estado == 'activo' %}
        {% set _ = trabajos_activos_list.append(trabajo) %}
    {% endif %}
{% endfor %}

{% if trabajos_activos_list %}
<section class="section">
    <div class="container">
        <div class="section-header">
            <h2>
                <i class="fas fa-users"></i>
                Trabajos Activos
            </h2>
            <a href="{{ url_for('empleador_trabajos_activos') }}" class="btn btn-outline">
                Ver Todos
            </a>
        </div>
        
        <div class="trabajos-activos-grid">
            {% for trabajo in trabajos_activos_list %}
            <div class="card trabajo-activo-card">
                <div class="trabajo-header">
                    <div class="trabajo-info">
                        <h3 class="trabajo-title">{{ trabajo.titulo }}</h3>
                        <div class="trabajo-meta">
                            <div class="meta-item">
                                <i class="fas fa-user-graduate"></i>
                                <span>
                                    {% set usuario_info = leer_json('data/usuarios.json')|selectattr('id', 'equalto', trabajo.usuario_id)|first %}
                                    {{ usuario_info.nombres }} {{ usuario_info.apellidos if usuario_info else 'N/A' }}
                                </span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-clock"></i>
                                <span>{{ trabajo.horario_trabajo }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="trabajo-status">
                        <span class="badge badge-success">Activo</span>
                    </div>
                </div>
                
                <div class="trabajo-actions">
                    <a href="{{ url_for('calificar_usuario', trabajo_activo_id=trabajo.id) }}" 
                       class="btn btn-warning">
                        <i class="fas fa-star"></i>
                        Calificar Desempeño
                    </a>
                    <a href="{{ url_for('iniciar_chat', user_id=trabajo.usuario_id) }}" 
                       class="btn btn-primary">
                        <i class="fas fa-envelope"></i>
                        Enviar Mensaje
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Sección de Trabajos Publicados -->
<section class="section">
    <div class="container">
        <div class="section-header">
            <h2>
                <i class="fas fa-briefcase"></i>
                Tus Trabajos Publicados
            </h2>
            <a href="{{ url_for('publicar_trabajo') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Nuevo Trabajo
            </a>
        </div>

        {% if trabajos %}
        <div class="trabajos-grid">
            {% for trabajo in trabajos %}
            <div class="card trabajo-card">
                <div class="trabajo-header">
                    <div class="trabajo-info">
                        <h3 class="trabajo-title">{{ trabajo.titulo }}</h3>
                        <p class="trabajo-description">{{ trabajo.descripcion[:100] }}{% if trabajo.descripcion|length > 100 %}...{% endif %}</p>
                    </div>
                    <div class="trabajo-stats">
                        <div class="stat-item">
                            <span class="stat-value">S/ {{ trabajo.pago }}</span>
                            <span class="stat-label">Pago</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">{{ trabajo.solicitudes|length }}</span>
                            <span class="stat-label">Solicitudes</span>
                        </div>
                    </div>
                </div>
                
                <div class="trabajo-footer">
                    <div class="trabajo-status">
                        <span class="badge badge-{{ 'success' if trabajo.estado == 'activo' else 'secondary' }}">
                            {{ trabajo.estado|title }}
                        </span>
                    </div>
                    
                    <div class="trabajo-actions">
                        <a href="{{ url_for('ver_postulaciones', trabajo_id=trabajo.id) }}" 
                           class="btn btn-primary btn-sm">
                            <i class="fas fa-eye"></i>
                            Postulaciones
                        </a>
                        <a href="{{ url_for('editar_trabajo', trabajo_id=trabajo.id) }}" 
                           class="btn btn-outline btn-sm">
                            <i class="fas fa-edit"></i>
                            Editar
                        </a>
                        <a href="{{ url_for('eliminar_trabajo', trabajo_id=trabajo.id) }}" 
                           class="btn btn-danger btn-sm"
                           onclick="return confirm('¿Estás seguro de eliminar este trabajo?')">
                            <i class="fas fa-trash"></i>
                            Eliminar
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-briefcase"></i>
            </div>
            <h3>No has publicado trabajos</h3>
            <p>Comienza publicando tu primera oportunidad laboral para conectar con talento universitario.</p>
            <a href="{{ url_for('publicar_trabajo') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Publicar Primer Trabajo
            </a>
        </div>
        {% endif %}
    </div>
</section>

<!-- Sección de Estadísticas -->
<section class="section">
    <div class="container">
        <div class="section-header">
            <h2>
                <i class="fas fa-chart-bar"></i>
                Estadísticas
            </h2>
        </div>
        
        <div class="stats-grid">
            <div class="card stat-card">
                <div class="stat-icon">
                    <i class="fas fa-briefcase"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" data-count="{{ total_trabajos }}">0</div>
                    <div class="stat-label">Trabajos Publicados</div>
                </div>
            </div>
            
            <div class="card stat-card">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" data-count="{{ trabajos_activos }}">0</div>
                    <div class="stat-label">Trabajos Activos</div>
                </div>
            </div>
            
            <div class="card stat-card">
                <div class="stat-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" data-count="{{ total_solicitudes }}">0</div>
                    <div class="stat-label">Solicitudes Recibidas</div>
                </div>
            </div>
            
            <div class="card stat-card">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" data-count="{{ trabajos_completados }}">0</div>
                    <div class="stat-label">Trabajos Completados</div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    /* Dashboard Header */
    .dashboard-header {
        background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
        color: white;
        padding: var(--space-8) 0;
    }
    
    .welcome-section {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: var(--space-8);
        align-items: center;
    }
    
    .welcome-title {
        font-size: var(--font-size-3xl);
        font-weight: var(--font-weight-bold);
        margin-bottom: var(--space-2);
        line-height: var(--line-height-tight);
    }
    
    .welcome-subtitle {
        font-size: var(--font-size-lg);
        opacity: 0.9;
        margin: 0;
    }
    
    .welcome-actions {
        display: flex;
        gap: var(--space-4);
        flex-wrap: wrap;
    }
    
    /* Info and Actions Grid */
    .info-actions-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--space-6);
    }
    
    .info-card, .actions-card {
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    
    .info-card .card-header, .actions-card .card-header {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        padding-bottom: var(--space-4);
    }
    
    .info-card .card-icon, .actions-card .card-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: var(--font-size-lg);
    }
    
    .company-info {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
    }
    
    .info-item {
        display: flex;
        align-items: flex-start;
        gap: var(--space-3);
        padding: var(--space-3);
        background: var(--gray-50);
        border-radius: var(--radius);
    }
    
    .info-item i {
        width: 20px;
        color: var(--primary-500);
        margin-top: var(--space-1);
        flex-shrink: 0;
    }
    
    .info-label {
        display: block;
        font-size: var(--font-size-sm);
        color: var(--gray-500);
        margin-bottom: var(--space-1);
    }
    
    .info-value {
        display: block;
        font-weight: var(--font-weight-semibold);
        color: var(--gray-700);
    }
    
    /* Actions Grid */
    .actions-grid {
        display: flex;
        flex-direction: column;
        gap: var(--space-2);
    }
    
    .action-item {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-3);
        border-radius: var(--radius);
        text-decoration: none;
        color: var(--gray-700);
        transition: all var(--transition-normal);
        border: 1px solid transparent;
    }
    
    .action-item:hover {
        background: var(--primary-50);
        border-color: var(--primary-100);
        transform: translateX(5px);
    }
    
    .action-icon {
        width: 40px;
        height: 40px;
        background: var(--primary-100);
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary-600);
        font-size: var(--font-size-lg);
        flex-shrink: 0;
    }
    
    .action-content {
        flex: 1;
    }
    
    .action-title {
        display: block;
        font-weight: var(--font-weight-semibold);
        margin-bottom: var(--space-1);
    }
    
    .action-description {
        display: block;
        font-size: var(--font-size-sm);
        color: var(--gray-600);
    }
    
    .action-arrow {
        color: var(--gray-400);
        transition: transform var(--transition-fast);
    }
    
    .action-item:hover .action-arrow {
        transform: translateX(3px);
        color: var(--primary-500);
    }
    
    /* Trabajos Activos */
    .trabajos-activos-grid {
        display: grid;
        gap: var(--space-6);
    }
    
    .trabajo-activo-card {
        border-left: 4px solid var(--success-500);
    }
    
    .trabajo-activo-card .trabajo-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--space-4);
    }
    
    .trabajo-title {
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-semibold);
        margin: 0 0 var(--space-2) 0;
        color: var(--gray-900);
    }
    
    .trabajo-meta {
        display: flex;
        flex-direction: column;
        gap: var(--space-2);
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        color: var(--gray-600);
        font-size: var(--font-size-sm);
    }
    
    .trabajo-actions {
        display: flex;
        gap: var(--space-3);
        flex-wrap: wrap;
    }
    
    /* Trabajos Publicados */
    .trabajos-grid {
        display: grid;
        gap: var(--space-6);
    }
    
    .trabajo-card {
        transition: transform var(--transition-normal);
    }
    
    .trabajo-card:hover {
        transform: translateY(-3px);
    }
    
    .trabajo-card .trabajo-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--space-4);
    }
    
    .trabajo-description {
        color: var(--gray-600);
        margin: var(--space-2) 0 0 0;
        line-height: var(--line-height-relaxed);
    }
    
    .trabajo-stats {
        display: flex;
        gap: var(--space-4);
        flex-shrink: 0;
    }
    
    .stat-item {
        text-align: center;
    }
    
    .stat-value {
        display: block;
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-bold);
        color: var(--primary-600);
    }
    
    .stat-label {
        display: block;
        font-size: var(--font-size-sm);
        color: var(--gray-500);
        margin-top: var(--space-1);
    }
    
    .trabajo-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: var(--space-4);
        border-top: 1px solid var(--gray-200);
    }
    
    .trabajo-card .trabajo-actions {
        display: flex;
        gap: var(--space-2);
    }
    
    /* Estadísticas */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--space-6);
    }
    
    .stat-card {
        text-align: center;
        padding: var(--space-6);
        transition: transform var(--transition-normal);
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }
    
    .stat-icon {
        font-size: var(--font-size-3xl);
        color: var(--primary-500);
        margin-bottom: var(--space-4);
    }
    
    .stat-number {
        font-size: var(--font-size-4xl);
        font-weight: var(--font-weight-bold);
        margin-bottom: var(--space-2);
        color: var(--gray-900);
    }
    
    .stat-label {
        font-size: var(--font-size-lg);
        color: var(--gray-600);
    }
    
    /* Alertas (reutilizando estilos del dashboard anterior) */
    .alertas-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: var(--space-6);
    }
    
    .alerta-card {
        border-left: 4px solid;
        transition: transform var(--transition-normal);
    }
    
    .alerta-card:hover {
        transform: translateY(-2px);
    }
    
    .alerta-urgente {
        border-left-color: var(--error-500);
    }
    
    .alerta-advertencia {
        border-left-color: var(--warning-500);
    }
    
    .alerta-informativa {
        border-left-color: var(--primary-500);
    }
    
    .alerta-header {
        display: flex;
        align-items: flex-start;
        gap: var(--space-4);
        margin-bottom: var(--space-4);
    }
    
    .alerta-icon {
        width: 40px;
        height: 40px;
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--font-size-lg);
        flex-shrink: 0;
    }
    
    .alerta-urgente .alerta-icon {
        background: var(--error-50);
        color: var(--error-600);
    }
    
    .alerta-advertencia .alerta-icon {
        background: var(--warning-50);
        color: var(--warning-600);
    }
    
    .alerta-informativa .alerta-icon {
        background: var(--primary-50);
        color: var(--primary-600);
    }
    
    .alerta-title {
        flex: 1;
    }
    
    .alerta-title h4 {
        margin: 0 0 var(--space-2) 0;
        font-size: var(--font-size-lg);
    }
    
    .alerta-time {
        text-align: right;
        flex-shrink: 0;
    }
    
    .alerta-badge {
        font-size: var(--font-size-xs);
        padding: var(--space-1) var(--space-3);
    }
    
    .badge-urgente {
        background: var(--error-100);
        color: var(--error-700);
    }
    
    .badge-advertencia {
        background: var(--warning-100);
        color: var(--warning-700);
    }
    
    .badge-informativa {
        background: var(--primary-100);
        color: var(--primary-700);
    }
    
    .alerta-body p {
        margin: 0;
        color: var(--gray-600);
        line-height: var(--line-height-relaxed);
    }
    
    /* Empty States */
    .empty-state {
        text-align: center;
        padding: var(--space-12) var(--space-6);
    }
    
    .empty-icon {
        font-size: var(--font-size-4xl);
        color: var(--gray-400);
        margin-bottom: var(--space-6);
    }
    
    .empty-state h3 {
        margin-bottom: var(--space-2);
        color: var(--gray-700);
    }
    
    .empty-state p {
        color: var(--gray-600);
        margin-bottom: var(--space-6);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .welcome-section {
            grid-template-columns: 1fr;
            text-align: center;
        }
        
        .welcome-actions {
            justify-content: center;
        }
        
        .info-actions-grid {
            grid-template-columns: 1fr;
        }
        
        .trabajo-card .trabajo-header {
            flex-direction: column;
            gap: var(--space-4);
        }
        
        .trabajo-stats {
            justify-content: flex-start;
        }
        
        .trabajo-footer {
            flex-direction: column;
            gap: var(--space-4);
            align-items: flex-start;
        }
        
        .trabajo-card .trabajo-actions {
            width: 100%;
            justify-content: flex-start;
        }
        
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .alertas-grid {
            grid-template-columns: 1fr;
        }
    }
    
    @media (max-width: 480px) {
        .dashboard-header {
            padding: var(--space-6) 0;
        }
        
        .welcome-title {
            font-size: var(--font-size-2xl);
        }
        
        .section {
            padding: var(--space-8) 0;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .trabajo-actions {
            flex-direction: column;
        }
        
        .trabajo-actions .btn {
            width: 100%;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Animación de entrada para las tarjetas
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);
        
        // Aplicar animación a todas las tarjetas
        document.querySelectorAll('.card').forEach(card => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            observer.observe(card);
        });
        
        // Contador animado para estadísticas
        const counters = document.querySelectorAll('.stat-number');
        counters.forEach(counter => {
            const target = +counter.getAttribute('data-count');
            if (target > 0) {
                const duration = 2000;
                const step = target / (duration / 16);
                let current = 0;
                
                const updateCounter = () => {
                    current += step;
                    if (current < target) {
                        counter.textContent = Math.ceil(current);
                        requestAnimationFrame(updateCounter);
                    } else {
                        counter.textContent = target;
                    }
                };
                
                const counterObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            updateCounter();
                            counterObserver.unobserve(entry.target);
                        }
                    });
                });
                
                counterObserver.observe(counter);
            }
        });
        
        // Confirmación mejorada para eliminar trabajos
        document.querySelectorAll('a[href*="eliminar_trabajo"]').forEach(link => {
            link.addEventListener('click', function(e) {
                if (!confirm('¿Estás seguro de que deseas eliminar este trabajo? Esta acción no se puede deshacer.')) {
                    e.preventDefault();
                }
            });
        });
        
        // Loading states para acciones
        document.querySelectorAll('.action-item').forEach(action => {
            action.addEventListener('click', function(e) {
                if (this.href) {
                    const originalHTML = this.innerHTML;
                    this.innerHTML = '<span class="loading"></span> Cargando...';
                    this.style.pointerEvents = 'none';
                    
                    setTimeout(() => {
                        this.innerHTML = originalHTML;
                        this.style.pointerEvents = 'auto';
                    }, 1500);
                }
            });
        });
    });
</script>
{% endblock %}